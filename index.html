<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Weather App</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700;800&family=Sora:wght@500;600;700&display=swap');

    :root {
      --bg-900: #07132d;
      --bg-800: #0c1d44;
      --panel-700: #102452;
      --panel-600: #183064;
      --text-100: #f4f8ff;
      --text-300: #b6caef;
      --accent-blue: #48afff;
      --accent-orange: #ff9d43;
      --accent-cyan: #7de5ff;
      --outline: rgba(179, 224, 255, 0.2);
      --shadow: 0 24px 50px rgba(2, 8, 27, 0.45);
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Outfit', sans-serif;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 24px;
      color: var(--text-100);
      background:
        radial-gradient(circle at 85% 12%, rgba(255, 162, 72, 0.35), transparent 38%),
        radial-gradient(circle at 12% 85%, rgba(71, 175, 255, 0.3), transparent 36%),
        linear-gradient(145deg, var(--bg-900) 0%, var(--bg-800) 60%, #142f63 100%);
      position: relative;
      overflow-x: hidden;
    }

    body.dark {
      background:
        radial-gradient(circle at 80% 10%, rgba(102, 131, 255, 0.25), transparent 40%),
        radial-gradient(circle at 15% 90%, rgba(95, 214, 255, 0.2), transparent 35%),
        linear-gradient(160deg, #060f22 0%, #09172f 58%, #122547 100%);
    }

    .header {
      width: min(1100px, 100%);
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 18px;
    }

    .title {
      font-family: 'Sora', sans-serif;
      color: #eef6ff;
      font-size: clamp(26px, 4vw, 34px);
      font-weight: 700;
      letter-spacing: 0.02em;
    }

    .theme-toggle {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      border: 1px solid var(--outline);
      background: linear-gradient(180deg, rgba(88, 172, 255, 0.22), rgba(255, 156, 74, 0.2));
      color: #f7fbff;
      font-size: 22px;
      cursor: pointer;
      display: grid;
      place-items: center;
      box-shadow: var(--shadow);
      transition: transform 0.25s ease, filter 0.25s ease;
    }

    .theme-toggle:hover {
      transform: translateY(-2px) rotate(10deg);
      filter: brightness(1.05);
    }

    .main-container {
      width: min(1100px, 100%);
      display: grid;
      grid-template-columns: 310px 1fr;
      gap: 20px;
      align-items: stretch;
      margin-bottom: 20px;
    }

    .search-container,
    .result,
    .forecast,
    .forecast-block {
      background: linear-gradient(165deg, rgba(25, 52, 105, 0.85), rgba(14, 33, 74, 0.9));
      border: 1px solid var(--outline);
      border-radius: 28px;
      box-shadow: var(--shadow);
      backdrop-filter: blur(12px);
    }

    .search-container {
      padding: 24px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
      gap: 18px;
      animation: liftIn 0.55s ease-out both;
    }

    .search-container h2 {
      font-family: 'Sora', sans-serif;
      font-size: 20px;
      font-weight: 600;
      color: #eff7ff;
    }

    .search-box {
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    input {
      width: 100%;
      border-radius: 14px;
      border: 1px solid rgba(184, 223, 255, 0.28);
      background: rgba(5, 15, 35, 0.4);
      color: #f3f9ff;
      padding: 14px 16px;
      font-size: 15px;
      outline: none;
      transition: border-color 0.25s ease, transform 0.25s ease;
    }

    input::placeholder {
      color: rgba(216, 232, 255, 0.6);
    }

    input:focus {
      border-color: var(--accent-cyan);
      transform: translateY(-1px);
    }

    .search-btn {
      border: 0;
      border-radius: 14px;
      padding: 13px 16px;
      color: #041534;
      font-size: 15px;
      font-weight: 700;
      cursor: pointer;
      background: linear-gradient(120deg, #79d8ff 0%, #53adff 54%, #ffa65f 100%);
      transition: transform 0.25s ease, filter 0.25s ease;
    }

    .search-btn:hover {
      transform: translateY(-2px);
      filter: saturate(1.1);
    }

    .result {
      padding: 24px;
      display: none;
    }

    .result.visible {
      display: block;
      animation: liftIn 0.55s ease-out both;
    }

    .weather-card-head {
      display: flex;
      justify-content: space-between;
      gap: 14px;
      align-items: flex-start;
      margin-bottom: 18px;
    }

    .location-label {
      font-size: 13px;
      color: var(--text-300);
      margin-bottom: 6px;
    }

    .result h3 {
      font-family: 'Sora', sans-serif;
      font-size: clamp(26px, 4vw, 32px);
      line-height: 1.1;
      color: #f0f8ff;
    }

    .status-pill {
      background: rgba(255, 166, 94, 0.23);
      color: #ffd7b1;
      border: 1px solid rgba(255, 191, 135, 0.35);
      border-radius: 999px;
      padding: 8px 12px;
      font-size: 12px;
      font-weight: 600;
      text-transform: capitalize;
    }

    .weather-main {
      display: flex;
      gap: 10px;
      align-items: center;
      margin-bottom: 16px;
    }

    .weather-main img {
      width: 110px;
      height: 110px;
      filter: drop-shadow(0 8px 18px rgba(23, 31, 54, 0.35));
      animation: floatUpDown 2.8s ease-in-out infinite;
    }

    .temp-col {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .temp-display {
      font-family: 'Sora', sans-serif;
      font-size: clamp(52px, 8vw, 68px);
      line-height: 0.95;
      letter-spacing: -0.03em;
    }

    .weather-condition {
      font-size: 15px;
      color: #ddedff;
      text-transform: capitalize;
      margin-bottom: 2px;
    }

    .temp-sub {
      font-size: 14px;
      color: var(--text-300);
    }

    .weather-details {
      display: grid;
      grid-template-columns: repeat(4, minmax(0, 1fr));
      gap: 10px;
      margin-top: 16px;
    }

    .detail-box {
      border-radius: 16px;
      padding: 12px;
      text-align: left;
      background: linear-gradient(150deg, rgba(74, 154, 255, 0.16), rgba(255, 162, 79, 0.12));
      border: 1px solid rgba(168, 217, 255, 0.25);
      transition: transform 0.25s ease, background 0.25s ease;
    }

    .detail-box:hover {
      transform: translateY(-2px);
      background: linear-gradient(150deg, rgba(74, 154, 255, 0.22), rgba(255, 162, 79, 0.18));
    }

    .detail-label {
      color: var(--text-300);
      font-size: 11px;
      margin-bottom: 5px;
      text-transform: uppercase;
    }

    .detail-value {
      font-size: 16px;
      font-weight: 600;
      color: #f2f8ff;
    }

    .forecast {
      width: min(1100px, 100%);
      display: none;
      padding: 22px;
      animation: liftIn 0.6s ease-out both;
    }

    .forecast.visible {
      display: block;
    }

    .forecast h3 {
      font-family: 'Sora', sans-serif;
      font-size: 20px;
      margin-bottom: 14px;
    }

    .forecast-sections {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 14px;
    }

    .forecast-block {
      padding: 16px;
      border-radius: 22px;
    }

    .forecast-block h4 {
      color: #d8ecff;
      font-size: 15px;
      margin-bottom: 10px;
      letter-spacing: 0.02em;
    }

    .forecast-grid {
      display: grid;
      grid-template-columns: repeat(2, minmax(0, 1fr));
      gap: 10px;
    }

    .day {
      background: linear-gradient(145deg, rgba(85, 167, 255, 0.15), rgba(255, 171, 100, 0.12));
      border: 1px solid rgba(178, 221, 255, 0.24);
      border-radius: 18px;
      padding: 12px;
      color: #f3f9ff;
      text-align: center;
      opacity: 0;
      transform: translateY(12px);
      animation: riseIn 0.5s ease forwards;
    }

    .day h4 {
      font-size: 14px;
      margin-bottom: 4px;
      color: #def0ff;
    }

    .day img {
      width: 56px;
      height: 56px;
      margin: 4px auto;
    }

    .day p {
      font-size: 13px;
      color: #dbeeff;
      margin: 2px 0;
    }

    .error-msg {
      padding: 28px;
      border-radius: 20px;
      text-align: center;
      background: rgba(26, 45, 92, 0.85);
      border: 1px solid rgba(255, 151, 151, 0.35);
      color: #ffd2d2;
      font-size: 17px;
      animation: fadeIn 0.35s ease;
    }

    @keyframes riseIn {
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes liftIn {
      from {
        opacity: 0;
        transform: translateY(12px);
      }
      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    @keyframes floatUpDown {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-6px); }
    }

    @media (max-width: 900px) {
      .main-container {
        grid-template-columns: 1fr;
      }

      .weather-details {
        grid-template-columns: repeat(2, minmax(0, 1fr));
      }

      .forecast-sections {
        grid-template-columns: 1fr;
      }
    }

    @media (max-width: 560px) {
      body {
        padding: 16px;
      }

      .weather-main {
        align-items: flex-start;
      }

      .weather-main img {
        width: 88px;
        height: 88px;
      }

      .temp-display {
        font-size: 52px;
      }

      .forecast-grid {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="header">
    <div class="title">Weather</div>
    <button class="theme-toggle" onclick="toggleTheme()">üåô</button>
  </div>
  <div class="main-container">
    <div class="search-container">
      <h2>Search Location</h2>
      <div class="search-box">
        <input type="text" id="locationInput" placeholder="Enter city name" />
        <button class="search-btn" onclick="getWeather()">Search</button>
      </div>
    </div>
    <div class="result" id="result"></div>
  </div>
  <div class="forecast" id="forecastContainer">
    <h3>2 Days Before & After</h3>
    <div class="forecast-sections">
      <div class="forecast-block">
        <h4>Previous 2 Days</h4>
        <div class="forecast-grid" id="pastForecast"></div>
      </div>
      <div class="forecast-block">
        <h4>Next 2 Days</h4>
        <div class="forecast-grid" id="futureForecast"></div>
      </div>
    </div>
  </div>
  <script>
    const apiKey = "6f9b4db0231f4a25bb7184129250609";

    function formatDate(date) {
      const year = date.getFullYear();
      const month = String(date.getMonth() + 1).padStart(2, "0");
      const day = String(date.getDate()).padStart(2, "0");
      return `${year}-${month}-${day}`;
    }

    function addDays(baseDate, days) {
      const date = new Date(baseDate);
      date.setDate(date.getDate() + days);
      return date;
    }
    
    function setLoadingState(isLoading) {
      const btn = document.querySelector('.search-btn');
      const input = document.getElementById('locationInput');
      if (isLoading) {
        btn.innerHTML = 'Searching...';
        btn.style.opacity = '0.7';
        btn.style.cursor = 'wait';
        btn.disabled = true;
        input.disabled = true;
      } else {
        btn.innerHTML = 'Search';
        btn.style.opacity = '1';
        btn.style.cursor = 'pointer';
        btn.disabled = false;
        input.disabled = false;
      }
    }
    // Fetch weather by city or coordinates
    async function getWeather(city = null, lat = null, lon = null) {
      setLoadingState(true);
      const resultDiv = document.getElementById("result");
      const pastForecastDiv = document.getElementById("pastForecast");
      const futureForecastDiv = document.getElementById("futureForecast");
      const forecastContainer = document.getElementById("forecastContainer");
      const locationInput = document.getElementById("locationInput").value;
      resultDiv.classList.remove('visible');
      forecastContainer.classList.remove('visible');
      let query = "";
      if (city) {
        query = city;
      } else if (lat && lon) {
        query = `${lat},${lon}`;
      } else if (locationInput) {
        query = locationInput;
      } else {
        resultDiv.innerHTML = '<div class="error-msg">‚ùå Please enter a location.</div>';
        resultDiv.classList.add('visible');
        setLoadingState(false);
        return;
      }
      const url = `https://api.weatherapi.com/v1/forecast.json?key=${apiKey}&q=${query}&days=3&aqi=yes&alerts=no`;
      try {
        const response = await fetch(url);
        if (!response.ok) {
          throw new Error("Location not found");
        }
        const data = await response.json();
        // Current weather
        const temp = data.current.temp_c;
        const feelsLike = data.current.feelslike_c;
        const humidity = data.current.humidity;
        const wind = data.current.wind_kph;
        const windDir = data.current.wind_dir;
        const pressure = data.current.pressure_mb;
        const precip = data.current.precip_mm;
        const condition = data.current.condition.text;
        const icon = data.current.condition.icon;
        const uv = data.current.uv;
        const visibility = data.current.vis_km;
        resultDiv.innerHTML = `
          <div class="weather-card-head">
            <div>
              <p class="location-label">Now in</p>
              <h3>${data.location.name}, ${data.location.country}</h3>
            </div>
            <span class="status-pill">${condition}</span>
          </div>
          <div class="weather-main">
            <img src="${icon}" alt="Weather Icon"/>
            <div class="temp-col">
              <div class="temp-display">${temp.toFixed(0)}¬∞C</div>
              <div class="weather-condition">${condition}</div>
              <p class="temp-sub">Feels like ${feelsLike.toFixed(1)}¬∞C</p>
            </div>
          </div>
          <div class="weather-details">
            <div class="detail-box">
              <div class="detail-label">Humidity</div>
              <div class="detail-value">${humidity.toFixed(1)}%</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Wind</div>
              <div class="detail-value">${wind.toFixed(1)} km/h</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Direction</div>
              <div class="detail-value">${windDir}</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Pressure</div>
              <div class="detail-value">${pressure.toFixed(0)} mb</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Visibility</div>
              <div class="detail-value">${visibility.toFixed(1)} km</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Precipitation</div>
              <div class="detail-value">${precip.toFixed(2)} mm</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">UV Index</div>
              <div class="detail-value">${uv.toFixed(1)}</div>
            </div>
            <div class="detail-box">
              <div class="detail-label">Feels Like</div>
              <div class="detail-value">${feelsLike.toFixed(1)}¬∞C</div>
            </div>
          </div>
        `;
        resultDiv.classList.add('visible');
        // Show split weather report: previous 2 days and next 2 days
        forecastContainer.classList.add('visible');
        pastForecastDiv.innerHTML = "";
        futureForecastDiv.innerHTML = "";

        const today = new Date(data.location.localtime.split(" ")[0] + "T00:00:00");
        const previousDates = [addDays(today, -2), addDays(today, -1)];
        const previousDateStrings = previousDates.map(formatDate);

        const historyResponses = await Promise.all(
          previousDateStrings.map((dateStr) =>
            fetch(`https://api.weatherapi.com/v1/history.json?key=${apiKey}&q=${query}&dt=${dateStr}`)
          )
        );

        const historyData = await Promise.all(
          historyResponses.map((historyResponse) => {
            if (!historyResponse.ok) {
              throw new Error("History not available");
            }
            return historyResponse.json();
          })
        );

        function createDayCard(day) {
          const date = new Date(day.date + "T00:00:00");
          const dayName = date.toLocaleDateString("en-US", { weekday: "short" });
          const avgTemp = day.day.avgtemp_c;
          const dayIcon = day.day.condition.icon;
          const rainChance = day.day.daily_chance_of_rain ?? day.day.daily_will_it_rain * 100;
          const dayDiv = document.createElement("div");
          dayDiv.classList.add("day");
          dayDiv.innerHTML = `
            <h4>${dayName}</h4>
            <img src="${dayIcon}" alt="Icon"/>
            <p><b>${avgTemp.toFixed(1)}¬∞C</b></p>
            <p>üåßÔ∏è ${rainChance}%</p>
          `;
          return dayDiv;
        }

        const pastDays = historyData.map((item) => item.forecast.forecastday[0]);
        const futureDays = data.forecast.forecastday.slice(1, 3);

        pastDays.forEach((day) => {
          pastForecastDiv.appendChild(createDayCard(day));
        });

        futureDays.forEach((day) => {
          futureForecastDiv.appendChild(createDayCard(day));
        });
      } catch (error) {
        resultDiv.innerHTML = '<div class="error-msg">‚ö†Ô∏è Could not fetch weather data. Please try again.</div>';
        resultDiv.classList.add('visible');
      } finally {
        setLoadingState(false);
      }
    }
    // Auto-detect location
    window.addEventListener("load", () => {
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          (position) => {
            const { latitude, longitude } = position.coords;
            getWeather(null, latitude, longitude);
          },
          () => {
            // If user denies geolocation, we can default to a fallback city
            getWeather("London");
            console.log("Geolocation not available or denied. Showing default location.");
          }
        );
      } else {
        // Fallback for very old browsers
        getWeather("London");
      }
    });
    // Toggle dark mode
    function toggleTheme() {
      const body = document.body;
      const themeToggle = document.querySelector('.theme-toggle');
      body.classList.toggle("dark");
      if (body.classList.contains("dark")) {
        themeToggle.innerHTML = '‚òÄÔ∏è';
      } else {
        themeToggle.innerHTML = 'üåô';
      }
    }
    // Allow Enter key to search
    document.addEventListener("keypress", (e) => {
      if (e.key === "Enter" && document.getElementById("locationInput") === document.activeElement) {
        getWeather();
      }
    });
  </script>
</body>
</html>
